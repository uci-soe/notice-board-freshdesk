import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { Container, ListGroup } from 'reactstrap';
import './Noticeboard.css';
import qs from 'qs';
import NoticeboardItem from './NoticeboardItem';
const ONE_MINUTE = 1000 * 60;

const buildQuery = opts => {
  let q = {};

  if (opts.order_by) {
    q['order_by'] = opts.order_by;
  }

  if (opts.order_type) {
    q['order_type'] = opts.order_type;
  }

  if (!opts.displayResolved) {
    q['filter'] = "new_and_my_open";
  }

  if (opts.updated_since) {
    q['updated_since'] = opts.updated_since;
  }

  if (opts.limit > 0) {
    q['per_page'] = '' + opts.limit;
  }

  if (opts.page > 1) {
    q['page'] = '' + opts.page;
  }

  return q;
};

const fetchResponse = (subdomain, auth, opts) => {
  return axios.get(`https://${subdomain}.freshdesk.com/api/v2/tickets`, {
    auth: auth,
    params: {
      include: 'requester,description',
      ...buildQuery(opts)
    },
    paramsSerializer: function (params) {
      return qs.stringify(params, {
        arrayFormat: 'brackets',
        encoder: function (str) {
          // Passed in values `a`, `b`, `c`
          return typeof str === 'string' ? str.trim().replace(/\s+/g, '%20') : str;
        }
      });
    }
  }).then(response => response.data).catch(err => {
    console.error(err.stack);
    return [];
  });
};

const Noticeboard = ({
  children,
  auth = {},
  subdomain = '',
  displayResolved = true,
  updated_since = "1970-01-01",
  limit = -1,
  page = 0,
  order_by = "created_at",
  order_type = "desc"
}) => {
  const [response, setResponse] = useState([]);
  useEffect(() => {
    let update;

    const updateFunc = () => {
      fetchResponse(subdomain, auth, {
        order_by,
        order_type,
        displayResolved,
        updated_since,
        limit,
        page
      }).then(resp => setResponse(resp));
      update = setTimeout(() => {
        updateFunc();
      }, 5 * ONE_MINUTE);
    };

    updateFunc();
    return () => {
      clearTimeout(update);
    }; // fetchResponse(subdomain, auth, {order_by, order_type, updated_since, displayResolved, limit, page})
    //   .then(resp => setResponse(resp))
    // ;
  }, [subdomain, auth]);
  const fsItem = children || NoticeboardItem;
  console.log(fsItem);
  return React.createElement(Container, {
    className: "freshdesk-notice"
  }, React.createElement(ListGroup, null, response.map(ticket => fsItem({
    ticket,
    key: ticket.id
  }))));
};

export default Noticeboard;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRzL05vdGljZWJvYXJkLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwidXNlU3RhdGUiLCJ1c2VFZmZlY3QiLCJheGlvcyIsIkNvbnRhaW5lciIsIkxpc3RHcm91cCIsInFzIiwiTm90aWNlYm9hcmRJdGVtIiwiT05FX01JTlVURSIsImJ1aWxkUXVlcnkiLCJvcHRzIiwicSIsIm9yZGVyX2J5Iiwib3JkZXJfdHlwZSIsImRpc3BsYXlSZXNvbHZlZCIsInVwZGF0ZWRfc2luY2UiLCJsaW1pdCIsInBhZ2UiLCJmZXRjaFJlc3BvbnNlIiwic3ViZG9tYWluIiwiYXV0aCIsImdldCIsInBhcmFtcyIsImluY2x1ZGUiLCJwYXJhbXNTZXJpYWxpemVyIiwic3RyaW5naWZ5IiwiYXJyYXlGb3JtYXQiLCJlbmNvZGVyIiwic3RyIiwidHJpbSIsInJlcGxhY2UiLCJ0aGVuIiwicmVzcG9uc2UiLCJkYXRhIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJzdGFjayIsIk5vdGljZWJvYXJkIiwiY2hpbGRyZW4iLCJzZXRSZXNwb25zZSIsInVwZGF0ZSIsInVwZGF0ZUZ1bmMiLCJyZXNwIiwic2V0VGltZW91dCIsImNsZWFyVGltZW91dCIsImZzSXRlbSIsImxvZyIsIm1hcCIsInRpY2tldCIsImtleSIsImlkIl0sIm1hcHBpbmdzIjoiQUFBQSxPQUFPQSxLQUFQLElBQWdCQyxRQUFoQixFQUEwQkMsU0FBMUIsUUFBMkMsT0FBM0M7QUFDQSxPQUFPQyxLQUFQLE1BQWtCLE9BQWxCO0FBQ0EsU0FDRUMsU0FERixFQUVFQyxTQUZGLFFBR08sWUFIUDtBQUlBLE9BQU8sbUJBQVA7QUFDQSxPQUFPQyxFQUFQLE1BQWUsSUFBZjtBQUNBLE9BQU9DLGVBQVAsTUFBNEIsbUJBQTVCO0FBRUEsTUFBTUMsVUFBVSxHQUFHLE9BQU8sRUFBMUI7O0FBRUEsTUFBTUMsVUFBVSxHQUFJQyxJQUFELElBQVU7QUFDM0IsTUFBSUMsQ0FBQyxHQUFHLEVBQVI7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QWtCO0FBQUNSLFFBQUFBLFFBQUQ7QUFBV0MsUUFBQUEsVUFBWDtBQUF1QkMsUUFBQUEsZUFBdkI7QUFBd0NDLFFBQUFBLGFBQXhDO0FBQXVEQyxRQUFBQSxLQUF2RDtBQUE4REMsUUFBQUE7QUFBOUQsT0FBbEIsQ0FBYixDQUNHYyxJQURILENBQ1FhLElBQUksSUFBSUgsV0FBVyxDQUFDRyxJQUFELENBRDNCO0FBR0FGLE1BQUFBLE1BQU0sR0FBR0csVUFBVSxDQUFDLE1BQU07QUFDeEJGLFFBQUFBLFVBQVU7QUFDWCxPQUZrQixFQUVoQixJQUFJbkMsVUFGWSxDQUFuQjtBQUdELEtBUEQ7O0FBU0FtQyxJQUFBQSxVQUFVO0FBRVYsV0FBTyxNQUFNO0FBQ1hHLE1BQUFBLFlBQVksQ0FBQ0osTUFBRCxDQUFaO0FBQ0QsS0FGRCxDQWJjLENBZ0JkO0FBQ0E7QUFDQTtBQUVELEdBcEJRLEVBb0JOLENBQUN2QixTQUFELEVBQVlDLElBQVosQ0FwQk0sQ0FBVDtBQXNCQSxRQUFNMkIsTUFBTSxHQUFHUCxRQUFRLElBQUlqQyxlQUEzQjtBQUNBNkIsRUFBQUEsT0FBTyxDQUFDWSxHQUFSLENBQVlELE1BQVo7QUFDQSxTQUNFLG9CQUFDLFNBQUQ7QUFBVyxJQUFBLFNBQVMsRUFBQztBQUFyQixLQUNFLG9CQUFDLFNBQUQsUUFDR2YsUUFBUSxDQUFDaUIsR0FBVCxDQUFjQyxNQUFELElBQVlILE1BQU0sQ0FBQztBQUFDRyxJQUFBQSxNQUFEO0FBQVNDLElBQUFBLEdBQUcsRUFBRUQsTUFBTSxDQUFDRTtBQUFyQixHQUFELENBQS9CLENBREgsQ0FERixDQURGO0FBT0QsQ0EvQ0Q7O0FBaURBLGVBQWViLFdBQWYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQge1xuICBDb250YWluZXIsXG4gIExpc3RHcm91cFxufSBmcm9tICdyZWFjdHN0cmFwJztcbmltcG9ydCAnLi9Ob3RpY2Vib2FyZC5jc3MnO1xuaW1wb3J0IHFzIGZyb20gJ3FzJztcbmltcG9ydCBOb3RpY2Vib2FyZEl0ZW0gZnJvbSAnLi9Ob3RpY2Vib2FyZEl0ZW0nO1xuXG5jb25zdCBPTkVfTUlOVVRFID0gMTAwMCAqIDYwO1xuXG5jb25zdCBidWlsZFF1ZXJ5ID0gKG9wdHMpID0+IHtcbiAgbGV0IHEgPSB7fTtcbiAgaWYgKG9wdHMub3JkZXJfYnkpIHtcbiAgICBxWydvcmRlcl9ieSddID0gb3B0cy5vcmRlcl9ieTtcbiAgfVxuICBpZiAob3B0cy5vcmRlcl90eXBlKSB7XG4gICAgcVsnb3JkZXJfdHlwZSddID0gb3B0cy5vcmRlcl90eXBlO1xuICB9XG4gIGlmICghb3B0cy5kaXNwbGF5UmVzb2x2ZWQpIHtcbiAgICBxWydmaWx0ZXInXSA9IFwibmV3X2FuZF9teV9vcGVuXCI7XG4gIH1cbiAgaWYgKG9wdHMudXBkYXRlZF9zaW5jZSkge1xuICAgIHFbJ3VwZGF0ZWRfc2luY2UnXSA9IG9wdHMudXBkYXRlZF9zaW5jZTtcbiAgfVxuICBpZiAob3B0cy5saW1pdCA+IDApIHtcbiAgICBxWydwZXJfcGFnZSddID0gJycgKyBvcHRzLmxpbWl0O1xuICB9XG4gIGlmIChvcHRzLnBhZ2UgPiAxKSB7XG4gICAgcVsncGFnZSddID0gJycgKyBvcHRzLnBhZ2U7XG4gIH1cblxuICByZXR1cm4gcTtcbn07XG5cbmNvbnN0IGZldGNoUmVzcG9uc2UgPSAoc3ViZG9tYWluLCBhdXRoLCBvcHRzKSA9PiB7XG4gIHJldHVybiBheGlvcy5nZXQoYGh0dHBzOi8vJHtzdWJkb21haW59LmZyZXNoZGVzay5jb20vYXBpL3YyL3RpY2tldHNgLCB7XG4gICAgYXV0aDogYXV0aCxcbiAgICBwYXJhbXM6IHtcbiAgICAgIGluY2x1ZGU6ICdyZXF1ZXN0ZXIsZGVzY3JpcHRpb24nLFxuICAgICAgLi4uYnVpbGRRdWVyeShvcHRzKVxuICAgIH0sXG4gICAgcGFyYW1zU2VyaWFsaXplcjogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgcmV0dXJuIHFzLnN0cmluZ2lmeShwYXJhbXMsIHtcbiAgICAgICAgYXJyYXlGb3JtYXQ6ICdicmFja2V0cycsIGVuY29kZXI6IGZ1bmN0aW9uIChzdHIpIHtcbiAgICAgICAgICAvLyBQYXNzZWQgaW4gdmFsdWVzIGBhYCwgYGJgLCBgY2BcbiAgICAgICAgICByZXR1cm4gdHlwZW9mIHN0ciA9PT0gJ3N0cmluZycgPyBzdHIudHJpbSgpLnJlcGxhY2UoL1xccysvZywgJyUyMCcpIDogc3RyO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sXG4gIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuZGF0YSlcbiAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLnN0YWNrKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9KTtcbn07XG5cbmNvbnN0IE5vdGljZWJvYXJkID0gKFxuICB7XG4gICAgY2hpbGRyZW4sXG4gICAgYXV0aCA9IHt9LFxuICAgIHN1YmRvbWFpbiA9ICcnLFxuICAgIGRpc3BsYXlSZXNvbHZlZCA9IHRydWUsXG4gICAgdXBkYXRlZF9zaW5jZSA9IFwiMTk3MC0wMS0wMVwiLFxuICAgIGxpbWl0ID0gLTEsXG4gICAgcGFnZSA9IDAsXG4gICAgb3JkZXJfYnkgPSBcImNyZWF0ZWRfYXRcIixcbiAgICBvcmRlcl90eXBlID0gXCJkZXNjXCJcbiAgfVxuKSA9PiB7XG5cbiAgY29uc3QgW3Jlc3BvbnNlLCBzZXRSZXNwb25zZV0gPSB1c2VTdGF0ZShbXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBsZXQgdXBkYXRlO1xuICAgIGNvbnN0IHVwZGF0ZUZ1bmMgPSAoKSA9PiB7XG4gICAgICBmZXRjaFJlc3BvbnNlKHN1YmRvbWFpbiwgYXV0aCwge29yZGVyX2J5LCBvcmRlcl90eXBlLCBkaXNwbGF5UmVzb2x2ZWQsIHVwZGF0ZWRfc2luY2UsIGxpbWl0LCBwYWdlfSlcbiAgICAgICAgLnRoZW4ocmVzcCA9PiBzZXRSZXNwb25zZShyZXNwKSlcbiAgICAgIDtcbiAgICAgIHVwZGF0ZSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB1cGRhdGVGdW5jKCk7XG4gICAgICB9LCA1ICogT05FX01JTlVURSk7XG4gICAgfTtcblxuICAgIHVwZGF0ZUZ1bmMoKTtcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQodXBkYXRlKTtcbiAgICB9XG4gICAgLy8gZmV0Y2hSZXNwb25zZShzdWJkb21haW4sIGF1dGgsIHtvcmRlcl9ieSwgb3JkZXJfdHlwZSwgdXBkYXRlZF9zaW5jZSwgZGlzcGxheVJlc29sdmVkLCBsaW1pdCwgcGFnZX0pXG4gICAgLy8gICAudGhlbihyZXNwID0+IHNldFJlc3BvbnNlKHJlc3ApKVxuICAgIC8vIDtcblxuICB9LCBbc3ViZG9tYWluLCBhdXRoXSk7XG5cbiAgY29uc3QgZnNJdGVtID0gY2hpbGRyZW4gfHwgTm90aWNlYm9hcmRJdGVtO1xuICBjb25zb2xlLmxvZyhmc0l0ZW0pO1xuICByZXR1cm4gKFxuICAgIDxDb250YWluZXIgY2xhc3NOYW1lPVwiZnJlc2hkZXNrLW5vdGljZVwiPlxuICAgICAgPExpc3RHcm91cD5cbiAgICAgICAge3Jlc3BvbnNlLm1hcCgodGlja2V0KSA9PiBmc0l0ZW0oe3RpY2tldCwga2V5OiB0aWNrZXQuaWR9KSl9XG4gICAgICA8L0xpc3RHcm91cD5cbiAgICA8L0NvbnRhaW5lcj5cbiAgKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgTm90aWNlYm9hcmQ7XG4iXX0=