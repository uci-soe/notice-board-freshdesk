import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { Container, ListGroup } from 'reactstrap';
import './Noticeboard.css';
import qs from 'qs';
import NoticeboardItem from './NoticeboardItem';

const TicketsNoTickets = () => {
  return React.createElement("div", {
    className: "no-tickets"
  });
};

const ONE_MINUTE = 1000 * 60;

const buildQuery = opts => {
  let q = {};

  if (opts.order_by) {
    q['order_by'] = opts.order_by;
  }

  if (opts.order_type) {
    q['order_type'] = opts.order_type;
  }

  if (!opts.displayResolved) {
    q['filter'] = "new_and_my_open";
  }

  if (opts.updated_since) {
    q['updated_since'] = opts.updated_since;
  }

  if (opts.limit > 0) {
    q['per_page'] = '' + opts.limit;
  }

  if (opts.page > 1) {
    q['page'] = '' + opts.page;
  }

  return q;
};

const fetchResponse = (subdomain, auth, opts) => {
  return axios.get(`https://${subdomain}.freshdesk.com/api/v2/tickets`, {
    auth: auth,
    params: {
      include: 'requester,description',
      ...buildQuery(opts)
    },
    paramsSerializer: function (params) {
      return qs.stringify(params, {
        arrayFormat: 'brackets',
        encoder: function (str) {
          // Passed in values `a`, `b`, `c`
          return typeof str === 'string' ? str.trim().replace(/\s+/g, '%20') : str;
        }
      });
    }
  }).then(response => response.data).catch(err => {
    console.error(err.stack);
    return [];
  });
};

const Noticeboard = ({
  children,
  auth = {},
  subdomain = '',
  displayResolved = true,
  updated_since = "1970-01-01",
  limit = -1,
  page = 0,
  order_by = "created_at",
  order_type = "desc",
  noTickets
}) => {
  const [response, setResponse] = useState([]);
  useEffect(() => {
    let update;

    const updateFunc = () => {
      fetchResponse(subdomain, auth, {
        order_by,
        order_type,
        displayResolved,
        updated_since,
        limit,
        page
      }).then(resp => setResponse(resp));
      update = setTimeout(() => {
        updateFunc();
      }, 5 * ONE_MINUTE);
    };

    updateFunc();
    return () => {
      clearTimeout(update);
    }; // fetchResponse(subdomain, auth, {order_by, order_type, updated_since, displayResolved, limit, page})
    //   .then(resp => setResponse(resp))
    // ;
  }, [subdomain, auth]);
  const fsItem = children || NoticeboardItem;
  const NoTickets = noTickets || TicketsNoTickets;
  console.log(fsItem);
  return React.createElement(ListGroup, {
    className: "tickets"
  }, response.length ? response.map(ticket => fsItem({
    ticket,
    key: ticket.id
  })) : NoTickets());
};

export default Noticeboard;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRzL05vdGljZWJvYXJkLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwidXNlU3RhdGUiLCJ1c2VFZmZlY3QiLCJheGlvcyIsIkNvbnRhaW5lciIsIkxpc3RHcm91cCIsInFzIiwiTm90aWNlYm9hcmRJdGVtIiwiVGlja2V0c05vVGlja2V0cyIsIk9ORV9NSU5VVEUiLCJidWlsZFF1ZXJ5Iiwib3B0cyIsInEiLCJvcmRlcl9ieSIsIm9yZGVyX3R5cGUiLCJkaXNwbGF5UmVzb2x2ZWQiLCJ1cGRhdGVkX3NpbmNlIiwibGltaXQiLCJwYWdlIiwiZmV0Y2hSZXNwb25zZSIsInN1YmRvbWFpbiIsImF1dGgiLCJnZXQiLCJwYXJhbXMiLCJpbmNsdWRlIiwicGFyYW1zU2VyaWFsaXplciIsInN0cmluZ2lmeSIsImFycmF5Rm9ybWF0IiwiZW5jb2RlciIsInN0ciIsInRyaW0iLCJyZXBsYWNlIiwidGhlbiIsInJlc3BvbnNlIiwiZGF0YSIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwic3RhY2siLCJOb3RpY2Vib2FyZCIsImNoaWxkcmVuIiwibm9UaWNrZXRzIiwic2V0UmVzcG9uc2UiLCJ1cGRhdGUiLCJ1cGRhdGVGdW5jIiwicmVzcCIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJmc0l0ZW0iLCJOb1RpY2tldHMiLCJsb2ciLCJsZW5ndGgiLCJtYXAiLCJ0aWNrZXQiLCJrZXkiLCJpZCJdLCJtYXBwaW5ncyI6IkFBQUEsT0FBT0EsS0FBUCxJQUFnQkMsUUFBaEIsRUFBMEJDLFNBQTFCLFFBQTJDLE9BQTNDO0FBQ0EsT0FBT0MsS0FBUCxNQUFrQixPQUFsQjtBQUNBLFNBQ0VDLFNBREYsRUFFRUMsU0FGRixRQUdPLFlBSFA7QUFJQSxPQUFPLG1CQUFQO0FBQ0EsT0FBT0MsRUFBUCxNQUFlLElBQWY7QUFDQSxPQUFPQyxlQUFQLE1BQTRCLG1CQUE1Qjs7QUFFQSxNQUFNQyxnQkFBZ0IsR0FBRyxNQUFNO0FBQzdCLFNBQVE7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U0FBUyxFQUhmLENBREo7QUFPRCxDQWpERDs7QUFtREEsZUFBZVYsV0FBZiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSwgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCB7XG4gIENvbnRhaW5lcixcbiAgTGlzdEdyb3VwXG59IGZyb20gJ3JlYWN0c3RyYXAnO1xuaW1wb3J0ICcuL05vdGljZWJvYXJkLmNzcyc7XG5pbXBvcnQgcXMgZnJvbSAncXMnO1xuaW1wb3J0IE5vdGljZWJvYXJkSXRlbSBmcm9tICcuL05vdGljZWJvYXJkSXRlbSc7XG5cbmNvbnN0IFRpY2tldHNOb1RpY2tldHMgPSAoKSA9PiB7XG4gIHJldHVybiAoPGRpdiBjbGFzc05hbWU9XCJuby10aWNrZXRzXCIgLz4pO1xufVxuXG5jb25zdCBPTkVfTUlOVVRFID0gMTAwMCAqIDYwO1xuXG5jb25zdCBidWlsZFF1ZXJ5ID0gKG9wdHMpID0+IHtcbiAgbGV0IHEgPSB7fTtcbiAgaWYgKG9wdHMub3JkZXJfYnkpIHtcbiAgICBxWydvcmRlcl9ieSddID0gb3B0cy5vcmRlcl9ieTtcbiAgfVxuICBpZiAob3B0cy5vcmRlcl90eXBlKSB7XG4gICAgcVsnb3JkZXJfdHlwZSddID0gb3B0cy5vcmRlcl90eXBlO1xuICB9XG4gIGlmICghb3B0cy5kaXNwbGF5UmVzb2x2ZWQpIHtcbiAgICBxWydmaWx0ZXInXSA9IFwibmV3X2FuZF9teV9vcGVuXCI7XG4gIH1cbiAgaWYgKG9wdHMudXBkYXRlZF9zaW5jZSkge1xuICAgIHFbJ3VwZGF0ZWRfc2luY2UnXSA9IG9wdHMudXBkYXRlZF9zaW5jZTtcbiAgfVxuICBpZiAob3B0cy5saW1pdCA+IDApIHtcbiAgICBxWydwZXJfcGFnZSddID0gJycgKyBvcHRzLmxpbWl0O1xuICB9XG4gIGlmIChvcHRzLnBhZ2UgPiAxKSB7XG4gICAgcVsncGFnZSddID0gJycgKyBvcHRzLnBhZ2U7XG4gIH1cblxuICByZXR1cm4gcTtcbn07XG5cbmNvbnN0IGZldGNoUmVzcG9uc2UgPSAoc3ViZG9tYWluLCBhdXRoLCBvcHRzKSA9PiB7XG4gIHJldHVybiBheGlvcy5nZXQoYGh0dHBzOi8vJHtzdWJkb21haW59LmZyZXNoZGVzay5jb20vYXBpL3YyL3RpY2tldHNgLCB7XG4gICAgYXV0aDogYXV0aCxcbiAgICBwYXJhbXM6IHtcbiAgICAgIGluY2x1ZGU6ICdyZXF1ZXN0ZXIsZGVzY3JpcHRpb24nLFxuICAgICAgLi4uYnVpbGRRdWVyeShvcHRzKVxuICAgIH0sXG4gICAgcGFyYW1zU2VyaWFsaXplcjogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgcmV0dXJuIHFzLnN0cmluZ2lmeShwYXJhbXMsIHtcbiAgICAgICAgYXJyYXlGb3JtYXQ6ICdicmFja2V0cycsIGVuY29kZXI6IGZ1bmN0aW9uIChzdHIpIHtcbiAgICAgICAgICAvLyBQYXNzZWQgaW4gdmFsdWVzIGBhYCwgYGJgLCBgY2BcbiAgICAgICAgICByZXR1cm4gdHlwZW9mIHN0ciA9PT0gJ3N0cmluZycgPyBzdHIudHJpbSgpLnJlcGxhY2UoL1xccysvZywgJyUyMCcpIDogc3RyO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sXG4gIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuZGF0YSlcbiAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyLnN0YWNrKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9KTtcbn07XG5cbmNvbnN0IE5vdGljZWJvYXJkID0gKFxuICB7XG4gICAgY2hpbGRyZW4sXG4gICAgYXV0aCA9IHt9LFxuICAgIHN1YmRvbWFpbiA9ICcnLFxuICAgIGRpc3BsYXlSZXNvbHZlZCA9IHRydWUsXG4gICAgdXBkYXRlZF9zaW5jZSA9IFwiMTk3MC0wMS0wMVwiLFxuICAgIGxpbWl0ID0gLTEsXG4gICAgcGFnZSA9IDAsXG4gICAgb3JkZXJfYnkgPSBcImNyZWF0ZWRfYXRcIixcbiAgICBvcmRlcl90eXBlID0gXCJkZXNjXCIsXG4gICAgbm9UaWNrZXRzXG4gIH1cbikgPT4ge1xuXG4gIGNvbnN0IFtyZXNwb25zZSwgc2V0UmVzcG9uc2VdID0gdXNlU3RhdGUoW10pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgbGV0IHVwZGF0ZTtcbiAgICBjb25zdCB1cGRhdGVGdW5jID0gKCkgPT4ge1xuICAgICAgZmV0Y2hSZXNwb25zZShzdWJkb21haW4sIGF1dGgsIHtvcmRlcl9ieSwgb3JkZXJfdHlwZSwgZGlzcGxheVJlc29sdmVkLCB1cGRhdGVkX3NpbmNlLCBsaW1pdCwgcGFnZX0pXG4gICAgICAgIC50aGVuKHJlc3AgPT4gc2V0UmVzcG9uc2UocmVzcCkpXG4gICAgICA7XG4gICAgICB1cGRhdGUgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdXBkYXRlRnVuYygpO1xuICAgICAgfSwgNSAqIE9ORV9NSU5VVEUpO1xuICAgIH07XG5cbiAgICB1cGRhdGVGdW5jKCk7XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY2xlYXJUaW1lb3V0KHVwZGF0ZSk7XG4gICAgfVxuICAgIC8vIGZldGNoUmVzcG9uc2Uoc3ViZG9tYWluLCBhdXRoLCB7b3JkZXJfYnksIG9yZGVyX3R5cGUsIHVwZGF0ZWRfc2luY2UsIGRpc3BsYXlSZXNvbHZlZCwgbGltaXQsIHBhZ2V9KVxuICAgIC8vICAgLnRoZW4ocmVzcCA9PiBzZXRSZXNwb25zZShyZXNwKSlcbiAgICAvLyA7XG5cbiAgfSwgW3N1YmRvbWFpbiwgYXV0aF0pO1xuXG4gIGNvbnN0IGZzSXRlbSA9IGNoaWxkcmVuIHx8IE5vdGljZWJvYXJkSXRlbTtcbiAgY29uc3QgTm9UaWNrZXRzID0gbm9UaWNrZXRzIHx8IFRpY2tldHNOb1RpY2tldHM7XG4gIGNvbnNvbGUubG9nKGZzSXRlbSk7XG4gIHJldHVybiAoXG4gICAgICA8TGlzdEdyb3VwIGNsYXNzTmFtZT1cInRpY2tldHNcIj5cbiAgICAgICAge3Jlc3BvbnNlLmxlbmd0aFxuICAgICAgICAgID8gcmVzcG9uc2UubWFwKCh0aWNrZXQpID0+IGZzSXRlbSh7dGlja2V0LCBrZXk6IHRpY2tldC5pZH0pKVxuICAgICAgICAgIDogTm9UaWNrZXRzKCl9XG4gICAgICA8L0xpc3RHcm91cD5cbiAgKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgTm90aWNlYm9hcmQ7XG4iXX0=